clc;
clear all;

r=0.5;

Ti=0; Tf=30;

TiTf1=Ti:.05:Tf

yy0=[0;0;0; 0.3803; -0.6198; 1.2867;pi/8; pi-0.3803; 0.6198; -1.2867;-pi/8;0;0;0;0;0;0;0;0;0;0;0];

[T1,Y1] = ode45(@rigid_1,TiTf1,yy0);

Tii=Tf; Tff=50;

TiTf2=Tii:.05:Tff

n=length(T1)

[thdotf ttf tbf vef]=Impact_eqns()

yy00=[Y1(n,1:6).';Y1(n,8:11).';0;0;tbf;thdotf(1:3);thdotf(5:8)];

x0=yy00(1); y0=yy00(2); th0=yy00(3); th1=yy00(4); th2=yy00(5); th3=yy00(6); th4=yy00(7); th5=yy00(8); th6=yy00(9); th7=yy00(10);

th8=(th4+th5+th6+th7+pi)-(th1+th2+th3)

l0=1;l1=1;l2=1; l3=1; l4=1;l5=1;l6=1; l7=3*1; lc0=.5*l0;lc1=.5*l1;lc2=.5*l2;lc3=.5*l3; lc4=.5*l4;lc5=.5*l5;lc6=.5*l6; lc7=.5*l7; 
Izz0=83.61; Izz1=1.05; Izz2=1.05; Izz3=1.05; Izz4=1.05; Izz5=1.05; Izz6=1.05; Izz7=3*1.05;


%%End Effector 1

l71=l7/3; l72=l7-l71;

J1=[0 0;0 0]
  
J2 =[ - l3*sin(th0 + th1 + th2 + th3) - l1*sin(th0 + th1) - lc0*sin(th0) - l2*sin(th0 + th1 + th2) - l71*sin(th0+th1+th2+th3+th8), - l3*sin(th0 + th1 + th2 + th3) - l1*sin(th0 + th1) - l2*sin(th0 + th1 + th2)- l71*sin(th0+th1+th2+th3+th8), - l3*sin(th0 + th1 + th2 + th3) - l2*sin(th0 + th1 + th2)- l71*sin(th0+th1+th2+th3+th8), -l3*sin(th0 + th1 + th2 + th3)- l71*sin(th0+th1+th2+th3+th8), - l71*sin(th0+th1+th2+th3+th8)
   l3*cos(th0 + th1 + th2 + th3) + l1*cos(th0 + th1) + lc0*cos(th0) + l2*cos(th0 + th1 + th2) + l71*cos(th0+th1+th2+th3+th8),   l3*cos(th0 + th1 + th2 + th3) + l1*cos(th0 + th1) + l2*cos(th0 + th1 + th2)+ l71*cos(th0+th1+th2+th3+th8),   l3*cos(th0 + th1 + th2 + th3) + l2*cos(th0 + th1 + th2)+ l71*cos(th0+th1+th2+th3+th8),  l3*cos(th0 + th1 + th2 + th3)+ l71*cos(th0+th1+th2+th3+th8), l71*cos(th0+th1+th2+th3+th8)]

J3 =[ - l6*sin(th0 + th4 + th5 + th6) - l4*sin(th0 + th4) + lc0*sin(th0) - l72*sin(th0 + th4 + th5 + th6 + th7) - l5*sin(th0 + th4 + th5), - l6*sin(th0 + th4 + th5 + th6) - l4*sin(th0 + th4) - l72*sin(th0 + th4 + th5 + th6 + th7) - l5*sin(th0 + th4 + th5), - l6*sin(th0 + th4 + th5 + th6) - l72*sin(th0 + th4 + th5 + th6 + th7) - l5*sin(th0 + th4 + th5), - l6*sin(th0 + th4 + th5 + th6) - l72*sin(th0 + th4 + th5 + th6 + th7), -l72*sin(th0 + th4 + th5 + th6 + th7)
   l6*cos(th0 + th4 + th5 + th6) + l4*cos(th0 + th4) - lc0*cos(th0) + l72*cos(th0 + th4 + th5 + th6 + th7) + l5*cos(th0 + th4 + th5),   l6*cos(th0 + th4 + th5 + th6) + l4*cos(th0 + th4) + l72*cos(th0 + th4 + th5 + th6 + th7) + l5*cos(th0 + th4 + th5),   l6*cos(th0 + th4 + th5 + th6) + l72*cos(th0 + th4 + th5 + th6 + th7) + l5*cos(th0 + th4 + th5),   l6*cos(th0 + th4 + th5 + th6) + l72*cos(th0 + th4 + th5 + th6 + th7),  l72*cos(th0 + th4 + th5 + th6 + th7)]

J(1:2,1:2)=J1;
J(1:2,4:6)=-J2(:,2:4);
J(1:2,11)=-J2(:,5)
J(1:2,7:10)=J3(1:2,2:5);
J(1:2,3)=-J2(:,1)+J3(:,1);

Je1(1,1:4)=ones(1,4)
Je1(1,9)=ones(1,1)

Je1(2:3,1:4)=J2(:,1:4);
Je1(2:3,9)=J2(:,5);

Je1(4,1)=ones(1,1)
Je1(4,5:8)=ones(1,4)

Je1(5:6,1)=J3(:,1)
Je1(5:6,5:8)=J3(:,2:5)


%%End Effector 2

l71=2*l7/3; l72=l7-l71;

J1=[0 0;0 0]
  
J2 =[ - l3*sin(th0 + th1 + th2 + th3) - l1*sin(th0 + th1) - lc0*sin(th0) - l2*sin(th0 + th1 + th2) - l71*sin(th0+th1+th2+th3+th8), - l3*sin(th0 + th1 + th2 + th3) - l1*sin(th0 + th1) - l2*sin(th0 + th1 + th2)- l71*sin(th0+th1+th2+th3+th8), - l3*sin(th0 + th1 + th2 + th3) - l2*sin(th0 + th1 + th2)- l71*sin(th0+th1+th2+th3+th8), -l3*sin(th0 + th1 + th2 + th3)- l71*sin(th0+th1+th2+th3+th8), - l71*sin(th0+th1+th2+th3+th8)
   l3*cos(th0 + th1 + th2 + th3) + l1*cos(th0 + th1) + lc0*cos(th0) + l2*cos(th0 + th1 + th2) + l71*cos(th0+th1+th2+th3+th8),   l3*cos(th0 + th1 + th2 + th3) + l1*cos(th0 + th1) + l2*cos(th0 + th1 + th2)+ l71*cos(th0+th1+th2+th3+th8),   l3*cos(th0 + th1 + th2 + th3) + l2*cos(th0 + th1 + th2)+ l71*cos(th0+th1+th2+th3+th8),  l3*cos(th0 + th1 + th2 + th3)+ l71*cos(th0+th1+th2+th3+th8), l71*cos(th0+th1+th2+th3+th8)]

J3 =[ - l6*sin(th0 + th4 + th5 + th6) - l4*sin(th0 + th4) + lc0*sin(th0) - l72*sin(th0 + th4 + th5 + th6 + th7) - l5*sin(th0 + th4 + th5), - l6*sin(th0 + th4 + th5 + th6) - l4*sin(th0 + th4) - l72*sin(th0 + th4 + th5 + th6 + th7) - l5*sin(th0 + th4 + th5), - l6*sin(th0 + th4 + th5 + th6) - l72*sin(th0 + th4 + th5 + th6 + th7) - l5*sin(th0 + th4 + th5), - l6*sin(th0 + th4 + th5 + th6) - l72*sin(th0 + th4 + th5 + th6 + th7), -l72*sin(th0 + th4 + th5 + th6 + th7)
   l6*cos(th0 + th4 + th5 + th6) + l4*cos(th0 + th4) - lc0*cos(th0) + l72*cos(th0 + th4 + th5 + th6 + th7) + l5*cos(th0 + th4 + th5),   l6*cos(th0 + th4 + th5 + th6) + l4*cos(th0 + th4) + l72*cos(th0 + th4 + th5 + th6 + th7) + l5*cos(th0 + th4 + th5),   l6*cos(th0 + th4 + th5 + th6) + l72*cos(th0 + th4 + th5 + th6 + th7) + l5*cos(th0 + th4 + th5),   l6*cos(th0 + th4 + th5 + th6) + l72*cos(th0 + th4 + th5 + th6 + th7),  l72*cos(th0 + th4 + th5 + th6 + th7)]

J(1:2,1:2)=J1;
J(1:2,4:6)=-J2(:,2:4);
J(1:2,11)=-J2(:,5)
J(1:2,7:10)=J3(1:2,2:5);
J(1:2,3)=-J2(:,1)+J3(:,1);

Je2(1,1:4)=ones(1,4)
Je2(1,9)=ones(1,1)

Je2(2:3,1:4)=J2(:,1:4);
Je2(2:3,9)=J2(:,5);

Je2(4,1)=ones(1,1)
Je2(4,5:8)=ones(1,4)

Je2(5:6,1)=J3(:,1)
Je2(5:6,5:8)=J3(:,2:5)

Je=[Je1;Je2]

thdot=pinv(Je)*[vef(1:2);vef(3);vef(1:2);vef(3);vef(4:5);vef(6);vef(4:5);vef(6)]

yy00(15:22)=thdot(1:8)

[T2,Y2] = ode45(@rigid_2,TiTf2,yy00);

T=[T1;T2];

Y(1:n,1:22)=Y1;
Y(n+1:length(T),1:6)=Y2(:,1:6);
Y(n+1:length(T),7)=Y2(:,7)+Y2(:,8)+Y2(:,9)+Y2(:,10)+pi*ones(length(T)-n,1)-(Y2(:,4)+Y2(:,5)+Y2(:,6));         %th8=(th4+th5+th6+th7+pi)-(th1+th2+th3)
Y(n+1:length(T),8:11)=Y2(:,7:10);

Y(n+1:length(T),12:17)=Y2(:,13:18);
Y(n+1:length(T),18)=Y2(:,19)+Y2(:,20)+Y2(:,21)+Y2(:,22)-(Y2(:,16)+Y2(:,17)+Y2(:,18));         %th8=(th4+th5+th6+th7+pi)-(th1+th2+th3)
Y(n+1:length(T),19:22)=Y2(:,19:22);


m0=500;m1=10;m2=10;m3=10;m4=10;m5=10;m6=10;m11=10; m12=10; m13=10; m14=10; m15=10; m16=10;
l0=1;l1=1;l2=1;l3=1;l4=1;l5=1;l6=1;l11=1; l12=1; l13=1; l14=1; l15=1; l16=1 ;
lc0=.5*l0;lc1=.5*l1;lc2=.5*l2;lc3=.5*l3; lc4=.5*l4;lc5=.5*l5;lc6=.5*l6;lc11=.5*l11;lc12=.5*l12;lc13=.5*l13; lc14=.5*l14;lc15=.5*l15;lc16=.5*l16;  
Izz0=83.61; Izz1=1.05; Izz2=1.05; Izz3=1.05;Izz4=1.05; Izz5=1.05; Izz6=1.05;Izz11=1.05; Izz12=1.05; Izz13=1.05;Izz14=1.05; Izz15=1.05; Izz16=1.05;


for i=1:n

    t=T(i)
    
  q(i,:)=Y(i,1:11)
  x0=q(i,1); y0=q(i,2); th0=q(i,3); th1=q(i,4); th2=q(i,5); th3=q(i,6); th4=q(i,7); th11=q(i,8); th12=q(i,9);  th13=q(i,10); th14=q(i,11);
 
M(:,:,i) =[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        m0 + m1 + m11 + m12 + m13 + m14 + m2 + m3 + m4,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             lc0*m11*sin(th0) - lc0*m1*sin(th0) + lc0*m12*sin(th0) + lc0*m13*sin(th0) + lc0*m14*sin(th0) - lc0*m2*sin(th0) - lc0*m3*sin(th0) - lc0*m4*sin(th0) - lc14*m14*sin(th0 + th11 + th12 + th13 + th14) - lc4*m4*sin(th0 + th1 + th2 + th3 + th4) - l12*m13*sin(th0 + th11 + th12) - l12*m14*sin(th0 + th11 + th12) - l2*m3*sin(th0 + th1 + th2) - l2*m4*sin(th0 + th1 + th2) - lc12*m12*sin(th0 + th11 + th12) - lc2*m2*sin(th0 + th1 + th2) - l13*m14*sin(th0 + th11 + th12 + th13) - l3*m4*sin(th0 + th1 + th2 + th3) - lc13*m13*sin(th0 + th11 + th12 + th13) - lc3*m3*sin(th0 + th1 + th2 + th3) - l11*m12*sin(th0 + th11) - l11*m13*sin(th0 + th11) - l11*m14*sin(th0 + th11) - l1*m2*sin(th0 + th1) - l1*m3*sin(th0 + th1) - l1*m4*sin(th0 + th1) - lc1*m1*sin(th0 + th1) - lc11*m11*sin(th0 + th11),                                                                                                                                                                                                                                                                                                                                                             - (m4*(2*l3*sin(th0 + th1 + th2 + th3) + 2*l1*sin(th0 + th1) + 2*lc4*sin(th0 + th1 + th2 + th3 + th4) + 2*l2*sin(th0 + th1 + th2)))/2 - (m3*(2*lc3*sin(th0 + th1 + th2 + th3) + 2*l1*sin(th0 + th1) + 2*l2*sin(th0 + th1 + th2)))/2 - (m2*(2*l1*sin(th0 + th1) + 2*lc2*sin(th0 + th1 + th2)))/2 - lc1*m1*sin(th0 + th1),                                                                                                                                                                                                                                                                                                              - (m4*(2*l3*sin(th0 + th1 + th2 + th3) + 2*lc4*sin(th0 + th1 + th2 + th3 + th4) + 2*l2*sin(th0 + th1 + th2)))/2 - (m3*(2*lc3*sin(th0 + th1 + th2 + th3) + 2*l2*sin(th0 + th1 + th2)))/2 - lc2*m2*sin(th0 + th1 + th2),                                                                                                                                                                                                                         - m4*(l3*sin(th0 + th1 + th2 + th3) + lc4*sin(th0 + th1 + th2 + th3 + th4)) - lc3*m3*sin(th0 + th1 + th2 + th3),                                                                                                 -lc4*m4*sin(th0 + th1 + th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                                                                                                        - (m14*(2*l13*sin(th0 + th11 + th12 + th13) + 2*l11*sin(th0 + th11) + 2*lc14*sin(th0 + th11 + th12 + th13 + th14) + 2*l12*sin(th0 + th11 + th12)))/2 - (m13*(2*lc13*sin(th0 + th11 + th12 + th13) + 2*l11*sin(th0 + th11) + 2*l12*sin(th0 + th11 + th12)))/2 - (m12*(2*l11*sin(th0 + th11) + 2*lc12*sin(th0 + th11 + th12)))/2 - lc11*m11*sin(th0 + th11),                                                                                                                                                                                                                                                                                                                                                                             - (m14*(2*l13*sin(th0 + th11 + th12 + th13) + 2*lc14*sin(th0 + th11 + th12 + th13 + th14) + 2*l12*sin(th0 + th11 + th12)))/2 - (m13*(2*lc13*sin(th0 + th11 + th12 + th13) + 2*l12*sin(th0 + th11 + th12)))/2 - lc12*m12*sin(th0 + th11 + th12),                                                                                                                                                                                                                                                                   - m14*(l13*sin(th0 + th11 + th12 + th13) + lc14*sin(th0 + th11 + th12 + th13 + th14)) - lc13*m13*sin(th0 + th11 + th12 + th13),                                                                                                                   -lc14*m14*sin(th0 + th11 + th12 + th13 + th14)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        m0 + m1 + m11 + m12 + m13 + m14 + m2 + m3 + m4,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             lc0*m1*cos(th0) - lc0*m11*cos(th0) - lc0*m12*cos(th0) - lc0*m13*cos(th0) - lc0*m14*cos(th0) + lc0*m2*cos(th0) + lc0*m3*cos(th0) + lc0*m4*cos(th0) + lc14*m14*cos(th0 + th11 + th12 + th13 + th14) + lc4*m4*cos(th0 + th1 + th2 + th3 + th4) + l12*m13*cos(th0 + th11 + th12) + l12*m14*cos(th0 + th11 + th12) + l2*m3*cos(th0 + th1 + th2) + l2*m4*cos(th0 + th1 + th2) + lc12*m12*cos(th0 + th11 + th12) + lc2*m2*cos(th0 + th1 + th2) + l13*m14*cos(th0 + th11 + th12 + th13) + l3*m4*cos(th0 + th1 + th2 + th3) + lc13*m13*cos(th0 + th11 + th12 + th13) + lc3*m3*cos(th0 + th1 + th2 + th3) + l11*m12*cos(th0 + th11) + l11*m13*cos(th0 + th11) + l11*m14*cos(th0 + th11) + l1*m2*cos(th0 + th1) + l1*m3*cos(th0 + th1) + l1*m4*cos(th0 + th1) + lc1*m1*cos(th0 + th1) + lc11*m11*cos(th0 + th11),                                                                                                                                                                                                                                                                                                                                                               (m2*(2*l1*cos(th0 + th1) + 2*lc2*cos(th0 + th1 + th2)))/2 + (m4*(2*l3*cos(th0 + th1 + th2 + th3) + 2*l1*cos(th0 + th1) + 2*lc4*cos(th0 + th1 + th2 + th3 + th4) + 2*l2*cos(th0 + th1 + th2)))/2 + (m3*(2*lc3*cos(th0 + th1 + th2 + th3) + 2*l1*cos(th0 + th1) + 2*l2*cos(th0 + th1 + th2)))/2 + lc1*m1*cos(th0 + th1),                                                                                                                                                                                                                                                                                                                (m4*(2*l3*cos(th0 + th1 + th2 + th3) + 2*lc4*cos(th0 + th1 + th2 + th3 + th4) + 2*l2*cos(th0 + th1 + th2)))/2 + (m3*(2*lc3*cos(th0 + th1 + th2 + th3) + 2*l2*cos(th0 + th1 + th2)))/2 + lc2*m2*cos(th0 + th1 + th2),                                                                                                                                                                                                                   (m4*(2*l3*cos(th0 + th1 + th2 + th3) + 2*lc4*cos(th0 + th1 + th2 + th3 + th4)))/2 + lc3*m3*cos(th0 + th1 + th2 + th3),                                                                                                  lc4*m4*cos(th0 + th1 + th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                                                                                                          (m12*(2*l11*cos(th0 + th11) + 2*lc12*cos(th0 + th11 + th12)))/2 + (m14*(2*l13*cos(th0 + th11 + th12 + th13) + 2*l11*cos(th0 + th11) + 2*lc14*cos(th0 + th11 + th12 + th13 + th14) + 2*l12*cos(th0 + th11 + th12)))/2 + (m13*(2*lc13*cos(th0 + th11 + th12 + th13) + 2*l11*cos(th0 + th11) + 2*l12*cos(th0 + th11 + th12)))/2 + lc11*m11*cos(th0 + th11),                                                                                                                                                                                                                                                                                                                                                                               (m14*(2*l13*cos(th0 + th11 + th12 + th13) + 2*lc14*cos(th0 + th11 + th12 + th13 + th14) + 2*l12*cos(th0 + th11 + th12)))/2 + (m13*(2*lc13*cos(th0 + th11 + th12 + th13) + 2*l12*cos(th0 + th11 + th12)))/2 + lc12*m12*cos(th0 + th11 + th12),                                                                                                                                                                                                                                                             (m14*(2*l13*cos(th0 + th11 + th12 + th13) + 2*lc14*cos(th0 + th11 + th12 + th13 + th14)))/2 + lc13*m13*cos(th0 + th11 + th12 + th13),                                                                                                                    lc14*m14*cos(th0 + th11 + th12 + th13 + th14)
 lc0*m11*sin(th0) - lc0*m1*sin(th0) + lc0*m12*sin(th0) + lc0*m13*sin(th0) + lc0*m14*sin(th0) - lc0*m2*sin(th0) - lc0*m3*sin(th0) - lc0*m4*sin(th0) - lc14*m14*sin(th0 + th11 + th12 + th13 + th14) - lc4*m4*sin(th0 + th1 + th2 + th3 + th4) - l12*m13*sin(th0 + th11 + th12) - l12*m14*sin(th0 + th11 + th12) - l2*m3*sin(th0 + th1 + th2) - l2*m4*sin(th0 + th1 + th2) - lc12*m12*sin(th0 + th11 + th12) - lc2*m2*sin(th0 + th1 + th2) - l13*m14*sin(th0 + th11 + th12 + th13) - l3*m4*sin(th0 + th1 + th2 + th3) - lc13*m13*sin(th0 + th11 + th12 + th13) - lc3*m3*sin(th0 + th1 + th2 + th3) - l11*m12*sin(th0 + th11) - l11*m13*sin(th0 + th11) - l11*m14*sin(th0 + th11) - l1*m2*sin(th0 + th1) - l1*m3*sin(th0 + th1) - l1*m4*sin(th0 + th1) - lc1*m1*sin(th0 + th1) - lc11*m11*sin(th0 + th11), lc0*m1*cos(th0) - lc0*m11*cos(th0) - lc0*m12*cos(th0) - lc0*m13*cos(th0) - lc0*m14*cos(th0) + lc0*m2*cos(th0) + lc0*m3*cos(th0) + lc0*m4*cos(th0) + lc14*m14*cos(th0 + th11 + th12 + th13 + th14) + lc4*m4*cos(th0 + th1 + th2 + th3 + th4) + l12*m13*cos(th0 + th11 + th12) + l12*m14*cos(th0 + th11 + th12) + l2*m3*cos(th0 + th1 + th2) + l2*m4*cos(th0 + th1 + th2) + lc12*m12*cos(th0 + th11 + th12) + lc2*m2*cos(th0 + th1 + th2) + l13*m14*cos(th0 + th11 + th12 + th13) + l3*m4*cos(th0 + th1 + th2 + th3) + lc13*m13*cos(th0 + th11 + th12 + th13) + lc3*m3*cos(th0 + th1 + th2 + th3) + l11*m12*cos(th0 + th11) + l11*m13*cos(th0 + th11) + l11*m14*cos(th0 + th11) + l1*m2*cos(th0 + th1) + l1*m3*cos(th0 + th1) + l1*m4*cos(th0 + th1) + lc1*m1*cos(th0 + th1) + lc11*m11*cos(th0 + th11), Izz0 + Izz1 + Izz2 + Izz3 + Izz4 + Izz11 + Izz12 + Izz13 + Izz14 + l11^2*m12 + l11^2*m13 + l11^2*m14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + l1^2*m2 + l1^2*m3 + l1^2*m4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc0^2*m1 + lc1^2*m1 + lc0^2*m11 + lc0^2*m12 + lc11^2*m11 + lc0^2*m13 + lc12^2*m12 + lc0^2*m14 + lc13^2*m13 + lc14^2*m14 + lc0^2*m2 + lc2^2*m2 + lc0^2*m3 + lc3^2*m3 + lc0^2*m4 + lc4^2*m4 - 2*lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + 2*lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + 2*l11*l13*m14*cos(th12 + th13) + 2*l1*l3*m4*cos(th2 + th3) - 2*l12*lc0*m13*cos(th11 + th12) + 2*l11*lc13*m13*cos(th12 + th13) - 2*l12*lc0*m14*cos(th11 + th12) + 2*l12*lc14*m14*cos(th13 + th14) + 2*l1*lc3*m3*cos(th2 + th3) + 2*l2*lc0*m3*cos(th1 + th2) + 2*l2*lc0*m4*cos(th1 + th2) + 2*l2*lc4*m4*cos(th3 + th4) - 2*lc0*lc12*m12*cos(th11 + th12) + 2*lc0*lc2*m2*cos(th1 + th2) + 2*l11*l12*m13*cos(th12) + 2*l11*l12*m14*cos(th12) + 2*l12*l13*m14*cos(th13) + 2*l1*l2*m3*cos(th2) + 2*l1*l2*m4*cos(th2) + 2*l2*l3*m4*cos(th3) - 2*l11*lc0*m12*cos(th11) - 2*l11*lc0*m13*cos(th11) + 2*l11*lc12*m12*cos(th12) - 2*l11*lc0*m14*cos(th11) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + 2*l1*lc0*m2*cos(th1) + 2*l1*lc2*m2*cos(th2) + 2*l1*lc0*m3*cos(th1) + 2*l1*lc0*m4*cos(th1) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + 2*lc0*lc1*m1*cos(th1) - 2*lc0*lc11*m11*cos(th11) + 2*l11*lc14*m14*cos(th12 + th13 + th14) - 2*l13*lc0*m14*cos(th11 + th12 + th13) + 2*l1*lc4*m4*cos(th2 + th3 + th4) + 2*l3*lc0*m4*cos(th1 + th2 + th3) - 2*lc0*lc13*m13*cos(th11 + th12 + th13) + 2*lc0*lc3*m3*cos(th1 + th2 + th3), Izz1 + Izz2 + Izz3 + Izz4 + l1^2*m2 + l1^2*m3 + l1^2*m4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc1^2*m1 + lc2^2*m2 + lc3^2*m3 + lc4^2*m4 + lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + 2*l1*l3*m4*cos(th2 + th3) + 2*l1*lc3*m3*cos(th2 + th3) + l2*lc0*m3*cos(th1 + th2) + l2*lc0*m4*cos(th1 + th2) + 2*l2*lc4*m4*cos(th3 + th4) + lc0*lc2*m2*cos(th1 + th2) + 2*l1*l2*m3*cos(th2) + 2*l1*l2*m4*cos(th2) + 2*l2*l3*m4*cos(th3) + l1*lc0*m2*cos(th1) + 2*l1*lc2*m2*cos(th2) + l1*lc0*m3*cos(th1) + l1*lc0*m4*cos(th1) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + lc0*lc1*m1*cos(th1) + 2*l1*lc4*m4*cos(th2 + th3 + th4) + l3*lc0*m4*cos(th1 + th2 + th3) + lc0*lc3*m3*cos(th1 + th2 + th3), Izz2 + Izz3 + Izz4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc2^2*m2 + lc3^2*m3 + lc4^2*m4 + lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + l1*l3*m4*cos(th2 + th3) + l1*lc3*m3*cos(th2 + th3) + l2*lc0*m3*cos(th1 + th2) + l2*lc0*m4*cos(th1 + th2) + 2*l2*lc4*m4*cos(th3 + th4) + lc0*lc2*m2*cos(th1 + th2) + l1*l2*m3*cos(th2) + l1*l2*m4*cos(th2) + 2*l2*l3*m4*cos(th3) + l1*lc2*m2*cos(th2) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4) + l3*lc0*m4*cos(th1 + th2 + th3) + lc0*lc3*m3*cos(th1 + th2 + th3), Izz3 + Izz4 + l3^2*m4 + lc3^2*m3 + lc4^2*m4 + lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + l1*l3*m4*cos(th2 + th3) + l1*lc3*m3*cos(th2 + th3) + l2*lc4*m4*cos(th3 + th4) + l2*l3*m4*cos(th3) + l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4) + l3*lc0*m4*cos(th1 + th2 + th3) + lc0*lc3*m3*cos(th1 + th2 + th3), Izz4 + lc4^2*m4 + lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + l2*lc4*m4*cos(th3 + th4) + l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4), Izz11 + Izz12 + Izz13 + Izz14 + l11^2*m12 + l11^2*m13 + l11^2*m14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + lc11^2*m11 + lc12^2*m12 + lc13^2*m13 + lc14^2*m14 - lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + 2*l11*l13*m14*cos(th12 + th13) - l12*lc0*m13*cos(th11 + th12) + 2*l11*lc13*m13*cos(th12 + th13) - l12*lc0*m14*cos(th11 + th12) + 2*l12*lc14*m14*cos(th13 + th14) - lc0*lc12*m12*cos(th11 + th12) + 2*l11*l12*m13*cos(th12) + 2*l11*l12*m14*cos(th12) + 2*l12*l13*m14*cos(th13) - l11*lc0*m12*cos(th11) - l11*lc0*m13*cos(th11) + 2*l11*lc12*m12*cos(th12) - l11*lc0*m14*cos(th11) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) - lc0*lc11*m11*cos(th11) + 2*l11*lc14*m14*cos(th12 + th13 + th14) - l13*lc0*m14*cos(th11 + th12 + th13) - lc0*lc13*m13*cos(th11 + th12 + th13), Izz12 + Izz13 + Izz14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + lc12^2*m12 + lc13^2*m13 + lc14^2*m14 - lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + l11*l13*m14*cos(th12 + th13) - l12*lc0*m13*cos(th11 + th12) + l11*lc13*m13*cos(th12 + th13) - l12*lc0*m14*cos(th11 + th12) + 2*l12*lc14*m14*cos(th13 + th14) - lc0*lc12*m12*cos(th11 + th12) + l11*l12*m13*cos(th12) + l11*l12*m14*cos(th12) + 2*l12*l13*m14*cos(th13) + l11*lc12*m12*cos(th12) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14) - l13*lc0*m14*cos(th11 + th12 + th13) - lc0*lc13*m13*cos(th11 + th12 + th13), Izz13 + Izz14 + l13^2*m14 + lc13^2*m13 + lc14^2*m14 - lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + l11*l13*m14*cos(th12 + th13) + l11*lc13*m13*cos(th12 + th13) + l12*lc14*m14*cos(th13 + th14) + l12*l13*m14*cos(th13) + l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14) - l13*lc0*m14*cos(th11 + th12 + th13) - lc0*lc13*m13*cos(th11 + th12 + th13), Izz14 + lc14^2*m14 - lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + l12*lc14*m14*cos(th13 + th14) + l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             - m4*(l3*sin(th0 + th1 + th2 + th3) + l1*sin(th0 + th1) + lc4*sin(th0 + th1 + th2 + th3 + th4) + l2*sin(th0 + th1 + th2)) - m3*(lc3*sin(th0 + th1 + th2 + th3) + l1*sin(th0 + th1) + l2*sin(th0 + th1 + th2)) - m2*(l1*sin(th0 + th1) + lc2*sin(th0 + th1 + th2)) - lc1*m1*sin(th0 + th1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               m2*(l1*cos(th0 + th1) + lc2*cos(th0 + th1 + th2)) + m4*(l3*cos(th0 + th1 + th2 + th3) + l1*cos(th0 + th1) + lc4*cos(th0 + th1 + th2 + th3 + th4) + l2*cos(th0 + th1 + th2)) + m3*(lc3*cos(th0 + th1 + th2 + th3) + l1*cos(th0 + th1) + l2*cos(th0 + th1 + th2)) + lc1*m1*cos(th0 + th1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Izz1 + Izz2 + Izz3 + Izz4 + l1^2*m2 + l1^2*m3 + l1^2*m4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc1^2*m1 + lc2^2*m2 + lc3^2*m3 + lc4^2*m4 + lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + 2*l1*l3*m4*cos(th2 + th3) + 2*l1*lc3*m3*cos(th2 + th3) + l2*lc0*m3*cos(th1 + th2) + l2*lc0*m4*cos(th1 + th2) + 2*l2*lc4*m4*cos(th3 + th4) + lc0*lc2*m2*cos(th1 + th2) + 2*l1*l2*m3*cos(th2) + 2*l1*l2*m4*cos(th2) + 2*l2*l3*m4*cos(th3) + l1*lc0*m2*cos(th1) + 2*l1*lc2*m2*cos(th2) + l1*lc0*m3*cos(th1) + l1*lc0*m4*cos(th1) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + lc0*lc1*m1*cos(th1) + 2*l1*lc4*m4*cos(th2 + th3 + th4) + l3*lc0*m4*cos(th1 + th2 + th3) + lc0*lc3*m3*cos(th1 + th2 + th3),                                                                                                                                                                                                                                                                                   Izz1 + Izz2 + Izz3 + Izz4 + l1^2*m2 + l1^2*m3 + l1^2*m4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc1^2*m1 + lc2^2*m2 + lc3^2*m3 + lc4^2*m4 + 2*l1*l3*m4*cos(th2 + th3) + 2*l1*lc3*m3*cos(th2 + th3) + 2*l2*lc4*m4*cos(th3 + th4) + 2*l1*l2*m3*cos(th2) + 2*l1*l2*m4*cos(th2) + 2*l2*l3*m4*cos(th3) + 2*l1*lc2*m2*cos(th2) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + 2*l1*lc4*m4*cos(th2 + th3 + th4),                                                                                                                                                                                              Izz2 + Izz3 + Izz4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc2^2*m2 + lc3^2*m3 + lc4^2*m4 + l1*l3*m4*cos(th2 + th3) + l1*lc3*m3*cos(th2 + th3) + 2*l2*lc4*m4*cos(th3 + th4) + l1*l2*m3*cos(th2) + l1*l2*m4*cos(th2) + 2*l2*l3*m4*cos(th3) + l1*lc2*m2*cos(th2) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4),                                                                                                            Izz3 + Izz4 + l3^2*m4 + lc3^2*m3 + lc4^2*m4 + l1*l3*m4*cos(th2 + th3) + l1*lc3*m3*cos(th2 + th3) + l2*lc4*m4*cos(th3 + th4) + l2*l3*m4*cos(th3) + l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4),                                         Izz4 + lc4^2*m4 + l2*lc4*m4*cos(th3 + th4) + l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   - m4*(l3*sin(th0 + th1 + th2 + th3) + lc4*sin(th0 + th1 + th2 + th3 + th4) + l2*sin(th0 + th1 + th2)) - m3*(lc3*sin(th0 + th1 + th2 + th3) + l2*sin(th0 + th1 + th2)) - lc2*m2*sin(th0 + th1 + th2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     m4*(l3*cos(th0 + th1 + th2 + th3) + lc4*cos(th0 + th1 + th2 + th3 + th4) + l2*cos(th0 + th1 + th2)) + m3*(lc3*cos(th0 + th1 + th2 + th3) + l2*cos(th0 + th1 + th2)) + lc2*m2*cos(th0 + th1 + th2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Izz2 + Izz3 + Izz4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc2^2*m2 + lc3^2*m3 + lc4^2*m4 + lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + l1*l3*m4*cos(th2 + th3) + l1*lc3*m3*cos(th2 + th3) + l2*lc0*m3*cos(th1 + th2) + l2*lc0*m4*cos(th1 + th2) + 2*l2*lc4*m4*cos(th3 + th4) + lc0*lc2*m2*cos(th1 + th2) + l1*l2*m3*cos(th2) + l1*l2*m4*cos(th2) + 2*l2*l3*m4*cos(th3) + l1*lc2*m2*cos(th2) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4) + l3*lc0*m4*cos(th1 + th2 + th3) + lc0*lc3*m3*cos(th1 + th2 + th3),                                                                                                                                                                                                                                                                                                                                               Izz2 + Izz3 + Izz4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc2^2*m2 + lc3^2*m3 + lc4^2*m4 + l1*l3*m4*cos(th2 + th3) + l1*lc3*m3*cos(th2 + th3) + 2*l2*lc4*m4*cos(th3 + th4) + l1*l2*m3*cos(th2) + l1*l2*m4*cos(th2) + 2*l2*l3*m4*cos(th3) + l1*lc2*m2*cos(th2) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                 Izz2 + Izz3 + Izz4 + l2^2*m3 + l2^2*m4 + l3^2*m4 + lc2^2*m2 + lc3^2*m3 + lc4^2*m4 + 2*l2*lc4*m4*cos(th3 + th4) + 2*l2*l3*m4*cos(th3) + 2*l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4),                                                                                                                                                                                                  m4*l3^2 + 2*m4*cos(th4)*l3*lc4 + l2*m4*cos(th3)*l3 + m3*lc3^2 + l2*m3*cos(th3)*lc3 + m4*lc4^2 + l2*m4*cos(th3 + th4)*lc4 + Izz3 + Izz4,                                                                          Izz4 + lc4^2*m4 + l2*lc4*m4*cos(th3 + th4) + l3*lc4*m4*cos(th4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       - m4*(l3*sin(th0 + th1 + th2 + th3) + lc4*sin(th0 + th1 + th2 + th3 + th4)) - lc3*m3*sin(th0 + th1 + th2 + th3),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         m4*(l3*cos(th0 + th1 + th2 + th3) + lc4*cos(th0 + th1 + th2 + th3 + th4)) + lc3*m3*cos(th0 + th1 + th2 + th3),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Izz3 + Izz4 + l3^2*m4 + lc3^2*m3 + lc4^2*m4 + lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + l1*l3*m4*cos(th2 + th3) + l1*lc3*m3*cos(th2 + th3) + l2*lc4*m4*cos(th3 + th4) + l2*l3*m4*cos(th3) + l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4) + l3*lc0*m4*cos(th1 + th2 + th3) + lc0*lc3*m3*cos(th1 + th2 + th3),                                                                                                                                                                                                                                                                                                                                                                                                                                                        Izz3 + Izz4 + l3^2*m4 + lc3^2*m3 + lc4^2*m4 + l1*l3*m4*cos(th2 + th3) + l1*lc3*m3*cos(th2 + th3) + l2*lc4*m4*cos(th3 + th4) + l2*l3*m4*cos(th3) + l2*lc3*m3*cos(th3) + 2*l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                                                             m4*l3^2 + 2*m4*cos(th4)*l3*lc4 + l2*m4*cos(th3)*l3 + m3*lc3^2 + l2*m3*cos(th3)*lc3 + m4*lc4^2 + l2*m4*cos(th3 + th4)*lc4 + Izz3 + Izz4,                                                                                                                                                                                                                                                                      m4*l3^2 + 2*m4*cos(th4)*l3*lc4 + m3*lc3^2 + m4*lc4^2 + Izz3 + Izz4,                                                                                                     m4*lc4^2 + l3*m4*cos(th4)*lc4 + Izz4,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              -lc4*m4*sin(th0 + th1 + th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               lc4*m4*cos(th0 + th1 + th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Izz4 + lc4^2*m4 + lc0*lc4*m4*cos(th1 + th2 + th3 + th4) + l2*lc4*m4*cos(th3 + th4) + l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Izz4 + lc4^2*m4 + l2*lc4*m4*cos(th3 + th4) + l3*lc4*m4*cos(th4) + l1*lc4*m4*cos(th2 + th3 + th4),                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Izz4 + lc4^2*m4 + l2*lc4*m4*cos(th3 + th4) + l3*lc4*m4*cos(th4),                                                                                                                                                                                                                                                                                                    m4*lc4^2 + l3*m4*cos(th4)*lc4 + Izz4,                                                                                                                          m4*lc4^2 + Izz4,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                                                                                                                                                0,                                                                                                                                                                0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           - m14*(l13*sin(th0 + th11 + th12 + th13) + l11*sin(th0 + th11) + lc14*sin(th0 + th11 + th12 + th13 + th14) + l12*sin(th0 + th11 + th12)) - m13*(lc13*sin(th0 + th11 + th12 + th13) + l11*sin(th0 + th11) + l12*sin(th0 + th11 + th12)) - m12*(l11*sin(th0 + th11) + lc12*sin(th0 + th11 + th12)) - lc11*m11*sin(th0 + th11),                                                                                                                                                                                                                                                                                                                                                                                                                                                                             m12*(l11*cos(th0 + th11) + lc12*cos(th0 + th11 + th12)) + m14*(l13*cos(th0 + th11 + th12 + th13) + l11*cos(th0 + th11) + lc14*cos(th0 + th11 + th12 + th13 + th14) + l12*cos(th0 + th11 + th12)) + m13*(lc13*cos(th0 + th11 + th12 + th13) + l11*cos(th0 + th11) + l12*cos(th0 + th11 + th12)) + lc11*m11*cos(th0 + th11),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Izz11 + Izz12 + Izz13 + Izz14 + l11^2*m12 + l11^2*m13 + l11^2*m14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + lc11^2*m11 + lc12^2*m12 + lc13^2*m13 + lc14^2*m14 - lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + 2*l11*l13*m14*cos(th12 + th13) - l12*lc0*m13*cos(th11 + th12) + 2*l11*lc13*m13*cos(th12 + th13) - l12*lc0*m14*cos(th11 + th12) + 2*l12*lc14*m14*cos(th13 + th14) - lc0*lc12*m12*cos(th11 + th12) + 2*l11*l12*m13*cos(th12) + 2*l11*l12*m14*cos(th12) + 2*l12*l13*m14*cos(th13) - l11*lc0*m12*cos(th11) - l11*lc0*m13*cos(th11) + 2*l11*lc12*m12*cos(th12) - l11*lc0*m14*cos(th11) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) - lc0*lc11*m11*cos(th11) + 2*l11*lc14*m14*cos(th12 + th13 + th14) - l13*lc0*m14*cos(th11 + th12 + th13) - lc0*lc13*m13*cos(th11 + th12 + th13),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                       0,                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                           Izz11 + Izz12 + Izz13 + Izz14 + l11^2*m12 + l11^2*m13 + l11^2*m14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + lc11^2*m11 + lc12^2*m12 + lc13^2*m13 + lc14^2*m14 + 2*l11*l13*m14*cos(th12 + th13) + 2*l11*lc13*m13*cos(th12 + th13) + 2*l12*lc14*m14*cos(th13 + th14) + 2*l11*l12*m13*cos(th12) + 2*l11*l12*m14*cos(th12) + 2*l12*l13*m14*cos(th13) + 2*l11*lc12*m12*cos(th12) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + 2*l11*lc14*m14*cos(th12 + th13 + th14),                                                                                                                                                                                                                          Izz12 + Izz13 + Izz14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + lc12^2*m12 + lc13^2*m13 + lc14^2*m14 + l11*l13*m14*cos(th12 + th13) + l11*lc13*m13*cos(th12 + th13) + 2*l12*lc14*m14*cos(th13 + th14) + l11*l12*m13*cos(th12) + l11*l12*m14*cos(th12) + 2*l12*l13*m14*cos(th13) + l11*lc12*m12*cos(th12) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14),                                                                                                                            Izz13 + Izz14 + l13^2*m14 + lc13^2*m13 + lc14^2*m14 + l11*l13*m14*cos(th12 + th13) + l11*lc13*m13*cos(th12 + th13) + l12*lc14*m14*cos(th13 + th14) + l12*l13*m14*cos(th13) + l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14),                                               Izz14 + lc14^2*m14 + l12*lc14*m14*cos(th13 + th14) + l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - m14*(l13*sin(th0 + th11 + th12 + th13) + lc14*sin(th0 + th11 + th12 + th13 + th14) + l12*sin(th0 + th11 + th12)) - m13*(lc13*sin(th0 + th11 + th12 + th13) + l12*sin(th0 + th11 + th12)) - lc12*m12*sin(th0 + th11 + th12),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            m14*(l13*cos(th0 + th11 + th12 + th13) + lc14*cos(th0 + th11 + th12 + th13 + th14) + l12*cos(th0 + th11 + th12)) + m13*(lc13*cos(th0 + th11 + th12 + th13) + l12*cos(th0 + th11 + th12)) + lc12*m12*cos(th0 + th11 + th12),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Izz12 + Izz13 + Izz14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + lc12^2*m12 + lc13^2*m13 + lc14^2*m14 - lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + l11*l13*m14*cos(th12 + th13) - l12*lc0*m13*cos(th11 + th12) + l11*lc13*m13*cos(th12 + th13) - l12*lc0*m14*cos(th11 + th12) + 2*l12*lc14*m14*cos(th13 + th14) - lc0*lc12*m12*cos(th11 + th12) + l11*l12*m13*cos(th12) + l11*l12*m14*cos(th12) + 2*l12*l13*m14*cos(th13) + l11*lc12*m12*cos(th12) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14) - l13*lc0*m14*cos(th11 + th12 + th13) - lc0*lc13*m13*cos(th11 + th12 + th13),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                       0,                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                Izz12 + Izz13 + Izz14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + lc12^2*m12 + lc13^2*m13 + lc14^2*m14 + l11*l13*m14*cos(th12 + th13) + l11*lc13*m13*cos(th12 + th13) + 2*l12*lc14*m14*cos(th13 + th14) + l11*l12*m13*cos(th12) + l11*l12*m14*cos(th12) + 2*l12*l13*m14*cos(th13) + l11*lc12*m12*cos(th12) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14),                                                                                                                                                                                                                                                                                                                                                                                                         Izz12 + Izz13 + Izz14 + l12^2*m13 + l12^2*m14 + l13^2*m14 + lc12^2*m12 + lc13^2*m13 + lc14^2*m14 + 2*l12*lc14*m14*cos(th13 + th14) + 2*l12*l13*m14*cos(th13) + 2*l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14),                                                                                                                                                                                                                                  m14*l13^2 + 2*m14*cos(th14)*l13*lc14 + l12*m14*cos(th13)*l13 + m13*lc13^2 + l12*m13*cos(th13)*lc13 + m14*lc14^2 + l12*m14*cos(th13 + th14)*lc14 + Izz13 + Izz14,                                                                                      Izz14 + lc14^2*m14 + l12*lc14*m14*cos(th13 + th14) + l13*lc14*m14*cos(th14)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - m14*(l13*sin(th0 + th11 + th12 + th13) + lc14*sin(th0 + th11 + th12 + th13 + th14)) - lc13*m13*sin(th0 + th11 + th12 + th13),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          m14*(l13*cos(th0 + th11 + th12 + th13) + lc14*cos(th0 + th11 + th12 + th13 + th14)) + lc13*m13*cos(th0 + th11 + th12 + th13),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Izz13 + Izz14 + l13^2*m14 + lc13^2*m13 + lc14^2*m14 - lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + l11*l13*m14*cos(th12 + th13) + l11*lc13*m13*cos(th12 + th13) + l12*lc14*m14*cos(th13 + th14) + l12*l13*m14*cos(th13) + l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14) - l13*lc0*m14*cos(th11 + th12 + th13) - lc0*lc13*m13*cos(th11 + th12 + th13),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                       0,                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Izz13 + Izz14 + l13^2*m14 + lc13^2*m13 + lc14^2*m14 + l11*l13*m14*cos(th12 + th13) + l11*lc13*m13*cos(th12 + th13) + l12*lc14*m14*cos(th13 + th14) + l12*l13*m14*cos(th13) + l12*lc13*m13*cos(th13) + 2*l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14),                                                                                                                                                                                                                                                                                                                                                                                                                                                            m14*l13^2 + 2*m14*cos(th14)*l13*lc14 + l12*m14*cos(th13)*l13 + m13*lc13^2 + l12*m13*cos(th13)*lc13 + m14*lc14^2 + l12*m14*cos(th13 + th14)*lc14 + Izz13 + Izz14,                                                                                                                                                                                                                                                                                                                   m14*l13^2 + 2*m14*cos(th14)*l13*lc14 + m13*lc13^2 + m14*lc14^2 + Izz13 + Izz14,                                                                                                                      m14*lc14^2 + l13*m14*cos(th14)*lc14 + Izz14
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -lc14*m14*sin(th0 + th11 + th12 + th13 + th14),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         lc14*m14*cos(th0 + th11 + th12 + th13 + th14),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Izz14 + lc14^2*m14 - lc0*lc14*m14*cos(th11 + th12 + th13 + th14) + l12*lc14*m14*cos(th13 + th14) + l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                       0,                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Izz14 + lc14^2*m14 + l12*lc14*m14*cos(th13 + th14) + l13*lc14*m14*cos(th14) + l11*lc14*m14*cos(th12 + th13 + th14),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Izz14 + lc14^2*m14 + l12*lc14*m14*cos(th13 + th14) + l13*lc14*m14*cos(th14),                                                                                                                                                                                                                                                                                                                                                      m14*lc14^2 + l13*m14*cos(th14)*lc14 + Izz14,                                                                                                                                               m14*lc14^2 + Izz14];
 

Ib(:,:,i)=M(1:3,1:3,i);
Ibm(:,:,i)=M(1:3,4:11,i);
Im(:,:,i)=M(4:11,4:11,i);

    
P(:,i)= Ib(:,:,i)*(Y(i,12:14).')+Ibm(:,:,i)*(Y(i,15:22).');


end

figure(1)
plot(T1,P(1,:),'b',T1,P(2,:),'r',T1,P(3,:),'g')
legend('Px','Py','Pz')
hold on
ymin=-1.5*10^-6;
ymax=1.5*10^-6;
xmin=0;
xmax=max(T1);
axis([xmin,xmax,ymin,ymax])
